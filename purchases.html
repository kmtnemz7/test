<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>My Purchases - PromptFi</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css?v=1756220420"/>
    <link rel="manifest" href="manifest.json"/>
    <link rel="icon" href="assets/img/favicon.png" type="image/png"/>
    <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js" defer></script>
  </head>
  <body>
    <noscript><style>#pageLoader{display:none}</style></noscript>
    <div id="pageLoader" class="page-loader" aria-hidden="true">
      <div class="spinner"></div>
    </div>
    
    <nav>
      <style>
        .ticker {
          display: flex;
          gap: 8px;
          align-items: center;
          justify-content: center;
          margin: 0 auto;
        }
        .t-tab {
          font: 600 14px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial;
          padding: 8px 12px;
          border-radius: 999px;
          border: 1px solid var(--b, #334155);
          background: var(--bg-2, #1a2332);
          color: var(--fg, #fff);
          cursor: pointer;
          opacity: 0.85;
          transition: transform 0.15s ease, border-color 0.15s ease, background 0.15s ease;
        }
        .t-tab:hover {
          transform: translateY(-1px);
          border-color: var(--acc1, #3b82f6);
        }
        @media (max-width:900px) {
          .ticker {
            gap: 4px;
            margin-left: auto;
            margin-right: auto;
          }
          .t-tab {
            font-size: 12px;
            padding: 6px 8px;
          }
        }
      </style>

      <div class="container navbar">
        <a href="index.html" class="brand">PromptFi</a>

        <!-- Live token ticker -->
        <div id="token-ticker" class="ticker">
          <div class="t-tab" data-view="price">$â€”</div>
          <div class="t-tab" data-view="mc">MC $â€”</div>
        </div>

        <div class="nav-actions">
          <div class="dropdown-container" style="position: relative;">
            <button id="menu-trigger" class="btn" aria-expanded="false" aria-haspopup="true">
              Menu â–¾
            </button>
            <div id="menu-dropdown" class="menu" style="display: none; position: absolute; top: calc(100% + 6px); right: 0; min-width: 160px; z-index: 1200;">
              <a href="explore.html">Explore</a>
              <a href="creators.html">Creators</a>
              <a href="purchases.html">My Purchases</a>
            </div>
          </div>
          <button id="walletBtn" class="btn glow" style="padding: 12px 18px; border-radius: 14px;">Connect Wallet</button>
        </div>
      </div>

      <script>
        (() => {
          const TOKEN = "9BB6NFEcjBCtnNLFko2FqVQBq8HHM13kCyYcdQbgpump"; // fartcoin test token
          const API  = `https://api.dexscreener.com/latest/dex/tokens/${TOKEN}`;

          const $ticker   = document.getElementById('token-ticker');
          const $priceBtn = $ticker.querySelector('[data-view="price"]');
          const $mcBtn    = $ticker.querySelector('[data-view="mc"]');

          let last = { priceUsd: null, marketCap: null };

          function fmtUsd(n){
            if (n == null) return "â€”";
            const abs = Math.abs(n);
            if (abs >= 1e9)  return `$${(n/1e9).toFixed(2)}B`;
            if (abs >= 1e6)  return `$${(n/1e6).toFixed(2)}M`;
            if (abs >= 1e3)  return `$${(n/1e3).toFixed(2)}K`;
            if (abs < 0.01)  return `$${n.toFixed(6)}`;
            return `$${n.toFixed(4)}`;
          }

          async function pull(){
            try{
              const r = await fetch(API, { cache: 'no-store' });
              const j = await r.json();
              const pair = (j.pairs || []).sort((a,b)=>(b.liquidity?.usd||0)-(a.liquidity?.usd||0))[0];
              if (!pair) return;
              last.priceUsd = Number(pair.priceUsd);
              last.marketCap = Number(pair.marketCap ?? pair.fdv);
              render();
            }catch(e){
              // keep old values
            }
          }

          function render(){
            $priceBtn.textContent = fmtUsd(last.priceUsd);
            $mcBtn.textContent    = `MC ${fmtUsd(last.marketCap)}`;
          }

          $ticker.addEventListener('click', (e) => {
            const b = e.target.closest('.t-tab');
            if (!b) return;
            $ticker.querySelectorAll('.t-tab').forEach(x=>x.classList.remove('active'));
            b.classList.add('active');
          });

          pull();
          setInterval(pull, 30000);
        })();
      </script>
    </nav>

    <div id="main-content">
      <section id="purchases" class="container" style="padding:40px 0;">
        <div class="kv" style="margin-bottom: 20px;">
          <h2>My Purchases</h2>
          <div id="addr" class="badge">Wallet: not connected</div>
        </div>

        <div id="purchasesList" class="card card-body">
          <div class="empty-state" style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">ðŸ“‹</div>
            <h3>No purchases yet</h3>
            <p class="muted">Your purchased prompts will appear here once you connect your wallet and make a purchase.</p>
            <div style="margin-top: 20px;">
              <a href="explore.html" class="btn glow">Explore Prompts</a>
            </div>
          </div>
        </div>

        <!-- This will be populated by JavaScript when wallet is connected -->
        <div id="purchasesGrid" class="grid grid-2" style="margin-top: 20px; display: none;"></div>

        <div class="card card-body" style="margin-top: 20px;">
          <h3>How to Access Your Purchases</h3>
          <div class="grid grid-2" style="gap: 20px; margin-top: 12px;">
            <div>
              <h4>ðŸ”— Connect Your Wallet</h4>
              <p class="muted">Your purchases are tied to your wallet address. Connect the same wallet you used to buy prompts.</p>
            </div>
            <div>
              <h4>ðŸ”„ Automatic Sync</h4>
              <p class="muted">Once connected, your purchases will automatically appear. If something's missing, try refreshing the page.</p>
            </div>
          </div>
        </div>
      </section>
    </div>

    <footer>
      <div class="container" style="display:flex;align-items:center;justify-content:space-between">
        <span>Â© 2025 PromptFi</span>
        <div style="display:flex;gap:12px">
          <a href="explore.html">Marketplace</a>
          <a href="purchases.html">My Purchases</a>
          <a href="index.html#how">How it works</a>
        </div>
      </div>
    </footer>

    <script defer src="assets/js/app.js?v=1756220420"></script>
  </body>
</html>

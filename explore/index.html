<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Explore Prompts - PromptFi</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css?v=1756220420"/>
    <link rel="manifest" href="manifest.json"/>
    <link rel="icon" href="assets/img/favicon.png" type="image/png"/>
    <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js" defer></script>
  </head>
  <body>
    <noscript><style>#pageLoader{display:none}</style></noscript>
    <div id="pageLoader" class="page-loader" aria-hidden="true">
      <div class="spinner"></div>
    </div>
    
    <nav>
      <style>
        .ticker {
          display: flex;
          gap: 8px;
          align-items: center;
          justify-content: center;
          margin: 0 auto;
        }
        .t-tab {
          font: 600 14px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial;
          padding: 8px 12px;
          border-radius: 999px;
          border: 1px solid var(--b, #334155);
          background: var(--bg-2, #1a2332);
          color: var(--fg, #fff);
          cursor: pointer;
          opacity: 0.85;
          transition: transform 0.15s ease, border-color 0.15s ease, background 0.15s ease;
        }
        .t-tab:hover {
          transform: translateY(-1px);
          border-color: var(--acc1, #3b82f6);
        }
        @media (max-width:900px) {
          .ticker {
            gap: 4px;
            margin-left: auto;
            margin-right: auto;
          }
          .t-tab {
            font-size: 12px;
            padding: 6px 8px;
          }
        }
      </style>

      <div class="container navbar">
        <a href="index.html" class="brand">PromptFi</a>

        <!-- Live token ticker -->
        <div id="token-ticker" class="ticker">
          <div class="t-tab" data-view="price">$—</div>
          <div class="t-tab" data-view="mc">MC $—</div>
        </div>

        <div class="nav-actions">
          <div class="dropdown-container" style="position: relative;">
            <button id="menu-trigger" class="btn" aria-expanded="false" aria-haspopup="true">
              Menu ▾
            </button>
            <div id="menu-dropdown" class="menu" style="display: none; position: absolute; top: calc(100% + 6px); right: 0; min-width: 160px; z-index: 1200;">
              <a href="explore.html">Explore</a>
              <a href="creators.html">Creators</a>
              <a href="purchases.html">My Purchases</a>
            </div>
          </div>
          <button id="walletBtn" class="btn glow" style="padding: 12px 18px; border-radius: 14px;">Connect Wallet</button>
        </div>
      </div>

      <script>
        (() => {
          const TOKEN = "9BB6NFEcjBCtnNLFko2FqVQBq8HHM13kCyYcdQbgpump"; // fartcoin test token
          const API  = `https://api.dexscreener.com/latest/dex/tokens/${TOKEN}`;

          const $ticker   = document.getElementById('token-ticker');
          const $priceBtn = $ticker.querySelector('[data-view="price"]');
          const $mcBtn    = $ticker.querySelector('[data-view="mc"]');

          let last = { priceUsd: null, marketCap: null };

          function fmtUsd(n){
            if (n == null) return "—";
            const abs = Math.abs(n);
            if (abs >= 1e9)  return `$${(n/1e9).toFixed(2)}B`;
            if (abs >= 1e6)  return `$${(n/1e6).toFixed(2)}M`;
            if (abs >= 1e3)  return `$${(n/1e3).toFixed(2)}K`;
            if (abs < 0.01)  return `$${n.toFixed(6)}`;
            return `$${n.toFixed(4)}`;
          }

          async function pull(){
            try{
              const r = await fetch(API, { cache: 'no-store' });
              const j = await r.json();
              const pair = (j.pairs || []).sort((a,b)=>(b.liquidity?.usd||0)-(a.liquidity?.usd||0))[0];
              if (!pair) return;
              last.priceUsd = Number(pair.priceUsd);
              last.marketCap = Number(pair.marketCap ?? pair.fdv);
              render();
            }catch(e){
              // keep old values
            }
          }

          function render(){
            $priceBtn.textContent = fmtUsd(last.priceUsd);
            $mcBtn.textContent    = `MC ${fmtUsd(last.marketCap)}`;
          }

          $ticker.addEventListener('click', (e) => {
            const b = e.target.closest('.t-tab');
            if (!b) return;
            $ticker.querySelectorAll('.t-tab').forEach(x=>x.classList.remove('active'));
            b.classList.add('active');
          });

          pull();
          setInterval(pull, 30000);
        })();
      </script>
    </nav>

    <div id="main-content">
      <div class="toast" id="toast"></div>

      <section id="market" class="container" style="padding:20px 0 8px;">
        <div class="kv" style="margin-bottom:8px">
          <h2>Explore Marketplace</h2>
          <div id="addr" class="badge">Wallet: not connected</div>
        </div>

        <section class="container filters" style="margin-top:12px;overflow:visible;">
          <div class="card card-body" style="overflow:visible">
            <div class="grid" style="grid-template-columns:2fr 1fr 1fr;gap:12px;align-items:end;overflow:visible">
              <label>Search<input id="q" class="input" placeholder="Search title or category"/></label>
              <details id="cat" class="select">
                <summary class="input trigger"><span>Category</span><span id="cat_val" class="value" data-value="">All</span></summary>
                <div class="menu"></div>
              </details>
              <details id="sort" class="select">
                <summary class="input trigger"><span>Sort</span><span id="sort_val" class="value" data-value="default">Default</span></summary>
                <div class="menu"></div>
              </details>
            </div>
          </div>
        </section>

        <div id="skeleton" class="grid grid-3">
          <div class="skel"></div><div class="skel"></div><div class="skel"></div>
        </div>
        <div id="grid" class="grid grid-3" style="margin-top:12px"></div>
      </section>
    </div>

    <footer>
      <div class="container" style="display:flex;align-items:center;justify-content:space-between">
        <span>© 2025 PromptFi</span>
        <div style="display:flex;gap:12px">
          <a href="explore.html">Marketplace</a>
          <a href="purchases.html">My Purchases</a>
          <a href="index.html#how">How it works</a>
        </div>
      </div>
    </footer>

    <!-- Modal -->
    <div id="modal" class="modal">
      <div class="box">
        <div class="kv">
          <h3 id="mTitle" style="margin:0">Prompt</h3>
          <button class="btn" onclick="closeModal()">✕</button>
        </div>
        <p id="mMeta" class="muted" style="margin:6px 0 0"></p>

        <div class="card" style="margin-top:12px">
          <div class="card-body">
            <label>Brief (what do you need?)<textarea id="uBrief" class="input" rows="3" placeholder="Describe what you need (topic, tone, goal)…"></textarea></label>
            <div class="grid" style="grid-template-columns:3fr 1fr;gap:10px;margin-top:10px">
              <input id="uContact" class="input" placeholder="Your contact (email or Telegram)"/>
              <button id="buyNow" class="btn glow">Buy & Unlock</button>
            </div>
          </div>
        </div>

        <div style="height:160px;border:1px solid var(--b);border-radius:12px;margin-top:12px;background:
          radial-gradient(90px 90px at 20% 30%, rgba(168,85,247,.25), transparent 60%),
          radial-gradient(90px 90px at 80% 40%, rgba(6,182,212,.25), transparent 60%);padding:12px;overflow:auto;">
          <p id="mText" style="margin:0;"></p>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <a id="txLink" target="_blank" class="btn hidden">View on Solscan</a>
          <button id="copyBtn" class="btn hidden">Copy Prompt</button>
        </div>
      </div>
    </div>

    <script defer src="assets/js/app.js?v=1756220420"></script>
  </body>
</html>
